let allMarkers=[];let markerCluster;async function getPointsOfInterest(url){const response=await fetch(url,{method:'GET',credentials:'include'});return response.json()}
async function initMap(){const allPointsOfInterest=await getPointsOfInterest('/poi');const dyfiWildlifeCentre={lat:52.568774,lng:-3.918031};const map=new google.maps.Map(document.getElementById('map'),{zoom:16,center:dyfiWildlifeCentre,mapTypeId:'hybrid',disableDefaultUI:!0,clickableIcons:!1});markerCluster=new MarkerClusterer(map,null,{imagePath:'images/clusters/m'});allPointsOfInterest.forEach(poi=>{const marker=new google.maps.Marker({position:{lat:poi.latitude,lng:poi.longitude},map:map,title:poi.name,description:poi.description,distanceFromCentre:poi.distanceFromCentre,category:poi.category});allMarkers.push(marker);markerCluster.addMarker(marker);marker.addListener('click',function(){const element=document.getElementById('poiCard');element.querySelector('#poi_title').innerHTML=marker.title;element.querySelector('#poi_description').innerHTML=marker.description;element.querySelector('#poi_distance').innerHTML=marker.distanceFromCentre;const instance=M.Modal.init(element,{dismissible:!0,inDuration:500,outDuration:500});instance.open()})})}
function filterMarkers(category){markerCluster.clearMarkers();for(let i=0;i<allMarkers.length;i ++){let marker=allMarkers[i];if(category==null||marker.category===category){marker.setVisible(!0);markerCluster.addMarker(marker)}else{marker.setVisible(!1)}}}